function initialUISetup(){$(window).resize(function(){adjustRelatedFactorsSize();var a=$(".contentBoxLeft");a.width()<490&&a.width()>377&&adjustRangeSliderThumbPosition()})}function updatePatientDemographicsBanner(){$("#patientName").text(CardiacRisk.patientInfo.firstName+" "+CardiacRisk.patientInfo.lastName),$("#patientAge").text(CardiacRisk.patientInfo.age+"yrs"),"male"===CardiacRisk.patientInfo.gender?$("#patientGender").text("M"):"female"===CardiacRisk.patientInfo.gender&&$("#patientGender").text("F");var a=CardiacRisk.patientInfo.dateOfBirth,b=a.getMonth()+"/"+a.getDate()+"/"+a.getFullYear();$("#patientDOB").text(b)}function updatePatientActions(){var a=CardiacRisk.computePatientActions();$("#contentDietExerciseHeader").text(a.dietHeader),$("#contentDietExercise").text(a.diet),$("#contentDoctorHeader").text(a.doctorHeader),$("#contentDoctor").text(a.doctor),$("#contentRetesting").text(a.retesting)}function checkForIncompleteState(){CardiacRisk.canCalculateCardiacRiskScore()?$("#sbpInput").val(CardiacRisk.patientInfo.systolicBloodPressure):($("#resultsInfo").removeClass("contentHidden"),$("#resultsSliders").removeClass("contentHidden"),$("#riskBar").removeClass().addClass("riskBarIncomplete"),$("#riskMessage").text("Incomplete"),$("#riskDescriptionText").text("Related factors must be completed in order to calculate your cardiac risk score."),$("#riskDescriptionValue").text(""),$("#containerPatientActions").removeClass().addClass("contentHiddenVisibility"),$("#whatIfContainer").removeClass().addClass("contentHidden"),$("#horizontalRule").removeClass().addClass("contentHidden"))}function validData(){var a=CardiacRisk.validateModelForErrors();return a.length>0?(processError(a),!1):!0}function processError(a){CardiacRisk.shouldProcessError&&(CardiacRisk.shouldProcessError=!1,$("#pageLoading").removeClass().addClass("contentHidden"),$("#pageError").removeClass().addClass("contentErrorLayout"),$("#pageContent").removeClass().addClass("contentHidden"),$("#pageErrorLabel").text(a))}function updateUI(){$("#containerPatientActions").removeClass().addClass("patientActions"),$("#whatIfContainer").removeClass().addClass("whatIfContainerLayout"),$("#horizontalRule").removeClass().addClass("hrStyle"),updateUICardiacRiskScore(),updateUIWhatIfSystolicBloodPressure(),updateUIWhatIfNotSmoker(),updateUIWhatIfOptimalValues(),updateASCVDRiskEstimates(),adjustRelatedFactorsSize()}function addEventListeners(){$("#sbpInput").keypress(function(a){return isNumberKey(a)}),$("#sbpInput").on("focusout",sbpInputFocusOutHandler),$('[name="smoker"]').change(onSmokerInput),$('[name="hypertension"]').change(onHypertensionInput),$('[name="race"]').change(onRaceInput),$('[name="diabetic"]').change(onDiabeticInput)}function onSBPInput(){var a=parseFloat(document.getElementById("sbpInput").value);CardiacRisk.isValidSysBP(a)?(CardiacRisk.patientInfo.systolicBloodPressure=a,$("#legendSysBPError").removeClass().addClass("relatedFactorsErrorsHidden"),$("#asteriskSBP").removeClass().addClass("contentHidden"),$("#sbpInput").val(a),CardiacRisk.canCalculateCardiacRiskScore()&&updateUI()):void 0!==CardiacRisk.patientInfo.systolicBloodPressure?$("#sbpInput").val(CardiacRisk.patientInfo.systolicBloodPressure):void 0===CardiacRisk.patientInfo.systolicBloodPressure&&($("#legendSysBPError").removeClass().addClass("relatedFactorsErrors"),$("#asteriskSBP").removeClass().addClass("asterisk"))}function onSmokerInput(){void 0===CardiacRisk.patientInfo.relatedFactors.smoker&&($("#legendSmokerError").toggleClass("relatedFactorsErrors relatedFactorsErrorsHidden"),$("#asteriskSmoker").removeClass().addClass("contentHidden")),"yes"===$(this).val()?(CardiacRisk.patientInfo.relatedFactors.smoker=!0,$("#contentSmokingHeader").text("Quit smoking"),$("#contentSmoking").text("By stopping smoking, you can drastically decrease your heart disease risk!")):(CardiacRisk.patientInfo.relatedFactors.smoker=!1,$("#whatIfNotSmoker").addClass("contentHidden"),$("#contentSmokingHeader").text("Stay smoke free"),$("#contentSmoking").text("By not smoking, you are keeping your heart disease risk low!")),CardiacRisk.canCalculateCardiacRiskScore()&&updateUI()}function onHypertensionInput(){void 0===CardiacRisk.patientInfo.relatedFactors.hypertension&&($("#legendHypertensionError").toggleClass("relatedFactorsErrors relatedFactorsErrorsHidden"),$("#asteriskHypertension").removeClass().addClass("contentHidden")),"yes"===$(this).val()?CardiacRisk.patientInfo.relatedFactors.hypertension=!0:CardiacRisk.patientInfo.relatedFactors.hypertension=!1,CardiacRisk.canCalculateASCVDScore()&&updateUI()}function onRaceInput(){void 0===CardiacRisk.patientInfo.relatedFactors.race&&($("#legendRaceError").toggleClass("relatedFactorsErrors relatedFactorsErrorsHidden"),$("#asteriskRace").removeClass().addClass("contentHidden")),"white"===$(this).val()?CardiacRisk.patientInfo.relatedFactors.race="white":"aa"===$(this).val()?CardiacRisk.patientInfo.relatedFactors.race="aa":CardiacRisk.patientInfo.relatedFactors.race="other",CardiacRisk.canCalculateASCVDScore()&&updateUI()}function onDiabeticInput(){void 0===CardiacRisk.patientInfo.relatedFactors.diabetic&&($("#legendDiabeticError").toggleClass("relatedFactorsErrors relatedFactorsErrorsHidden"),$("#asteriskDiabetic").removeClass().addClass("contentHidden")),"yes"===$(this).val()?CardiacRisk.patientInfo.relatedFactors.diabetic=!0:CardiacRisk.patientInfo.relatedFactors.diabetic=!1,CardiacRisk.canCalculateASCVDScore()&&updateUI()}function updateUICardiacRiskScore(){var a=CardiacRisk.computeRRS(CardiacRisk.patientInfo);$("#riskDescriptionText").text("Your chance of having a heart attack, stroke, or other heart disease event at some point in the next 10 years is "),$("#riskDescriptionValue").text(a+"%");var b=$("#riskBar"),c=$("#riskMessage");5>a?(b.removeClass().addClass("riskBarLowRisk"),c.text("Low Risk")):a>=5&&10>a?(b.removeClass().addClass("riskBarLowModerateRisk"),c.text("Low-Moderate Risk")):a>=10&&20>a?(b.removeClass().addClass("riskBarModerateRisk"),c.text("Moderate Risk")):a>=20&&(b.removeClass().addClass("riskBarHighRisk"),c.text("High Risk"))}function updateASCVDRiskEstimates(){var a=CardiacRisk.computeTenYearASCVD(CardiacRisk.patientInfo),b=CardiacRisk.computeOptimalASCVD(),c=CardiacRisk.computeLifetimeRisk(CardiacRisk.patientInfo,!1),d=CardiacRisk.computeLifetimeRisk(CardiacRisk.patientInfo,!0);null===a||null===b?($("#tenYearASCVDEstimate").text("ASCVD 10-year Risk Estimate can only be computed for those in the age range of 40-79"),$("#tenYearASCVDOptimalEstimate").text("ASCVD 10-year Risk Estimate can only be computed for those in the age range of 40-79")):($("#tenYearASCVDEstimate").text("ASCVD 10-year: "+Math.round(100*a*10)/10+"%"),$("#tenYearASCVDOptimalEstimate").text("ASCVD 10-year (optimal): "+Math.round(100*b*10)/10+"%")),null===c||null===d?($("#lifetimeASCVDEstimate").text("Lifetime ASCVD Risk Estimate can only be computed for those in the age range of 20-59"),$("#lifetimeASCVDEstimate").text("Lifetime ASCVD Risk Estimate can only be computed for those in the age range of 20-59")):($("#lifetimeASCVDEstimate").text("Lifetime ASCVD Risk Estimate: "+c+"%"),$("#lifetimeASCVDOptimalEstimate").text("Lifetime ASCVD Risk Estimate (optimal conditions): "+d+"%"))}function updateUIWhatIfSystolicBloodPressure(){var a=CardiacRisk.computeWhatIfSBP();void 0===a?$("#whatIfSBP").addClass("contentHidden"):($("#whatIfSBP").removeClass("contentHidden"),$("#whatIfSBPValue").text(a.value),$("#whatIfSBPValueText").text(a.valueText))}function updateUIWhatIfNotSmoker(){if(CardiacRisk.patientInfo.relatedFactors.smoker===!0){var a=CardiacRisk.computeWhatIfNotSmoker(),b=CardiacRisk.buildWhatIfNotSmoker(a);$("#whatIfNotSmoker").removeClass("contentHidden"),$("#whatIfNoSmokerValue").text(b.value)}else $("#whatIfNotSmoker").addClass("contentHidden")}function updateUIWhatIfOptimalValues(){var a=CardiacRisk.computeWhatIfOptimal(),b=CardiacRisk.buildWhatIfOptimalValues(a);$("#whatIfOptimalValue").text(b.value),$("#whatIfOptimalValueText").text(b.valueText)}function createRangeSliderGraphs(){buildRangeSliderDataModel(),createCholesterolSlider(),createLDLSlider(),createHDLSlider()}function createCholesterolSlider(){var a="",b="",c="";CardiacRisk.patientInfo.totalCholesterol<200?(a=CardiacRisk.graphData.totalCholesterolSliderData.toolTipData.keys[0],b=CardiacRisk.colorClasses.lowRisk):CardiacRisk.patientInfo.totalCholesterol>=200&&CardiacRisk.patientInfo.totalCholesterol<240?(a=CardiacRisk.graphData.totalCholesterolSliderData.toolTipData.keys[1],b=CardiacRisk.colorClasses.moderateRisk):CardiacRisk.patientInfo.totalCholesterol>=240&&(a=CardiacRisk.graphData.totalCholesterolSliderData.toolTipData.keys[2],b=CardiacRisk.colorClasses.highRisk,c=CardiacRisk.colorClasses.rangeSliderThumbWhiteText),CardiacRisk.graphData.totalCholesterolSliderData.thumbDisplayText=a,CardiacRisk.graphData.totalCholesterolSliderData.value=CardiacRisk.patientInfo.totalCholesterol,generateRangeSlider(CardiacRisk.graphData.totalCholesterolSliderData),changeBarBackgroundColor(CardiacRisk.graphData.totalCholesterolSliderData.id,CardiacRisk.colorClasses.grayBarColor),changeThumbBackgroundColor(CardiacRisk.graphData.totalCholesterolSliderData.id,b),changeThumbTextColor(CardiacRisk.graphData.totalCholesterolSliderData.id,c)}function createLDLSlider(){if(void 0===CardiacRisk.patientInfo.ldl)$("#ldlBadCholesterolSlider").addClass("contentHidden"),$("#rangeSlidersVerticalLine").removeClass().addClass("verticalLineHalf");else{var a="",b="",c="";CardiacRisk.patientInfo.ldl<100?(a=CardiacRisk.graphData.ldlSliderData.toolTipData.keys[0],b=CardiacRisk.colorClasses.lowRisk):CardiacRisk.patientInfo.ldl>=100&&CardiacRisk.patientInfo.ldl<130?(a=CardiacRisk.graphData.ldlSliderData.toolTipData.keys[1],b=CardiacRisk.colorClasses.lowModerateRisk):CardiacRisk.patientInfo.ldl>=130&&CardiacRisk.patientInfo.ldl<160?(a=CardiacRisk.graphData.ldlSliderData.toolTipData.keys[2],b=CardiacRisk.colorClasses.moderateRisk):CardiacRisk.patientInfo.ldl>=160&&CardiacRisk.patientInfo.ldl<190?(a=CardiacRisk.graphData.ldlSliderData.toolTipData.keys[3],b=CardiacRisk.colorClasses.highRisk,c=CardiacRisk.colorClasses.rangeSliderThumbWhiteText):CardiacRisk.patientInfo.ldl>=190&&(a=CardiacRisk.graphData.ldlSliderData.toolTipData.keys[4],b=CardiacRisk.colorClasses.highRisk,c=CardiacRisk.colorClasses.rangeSliderThumbWhiteText),CardiacRisk.graphData.ldlSliderData.thumbDisplayText=a,CardiacRisk.graphData.ldlSliderData.value=CardiacRisk.patientInfo.ldl,generateRangeSlider(CardiacRisk.graphData.ldlSliderData),changeBarBackgroundColor(CardiacRisk.graphData.ldlSliderData.id,CardiacRisk.colorClasses.grayBarColor),changeThumbBackgroundColor(CardiacRisk.graphData.ldlSliderData.id,b),changeThumbTextColor(CardiacRisk.graphData.ldlSliderData.id,c)}}function createHDLSlider(){var a="",b="",c="";CardiacRisk.patientInfo.hdl<40&&"male"===CardiacRisk.patientInfo.gender||CardiacRisk.patientInfo.hdl<50&&"female"===CardiacRisk.patientInfo.gender?(a=CardiacRisk.graphData.hdlSliderData.toolTipData.keys[2],b=CardiacRisk.colorClasses.highRisk,c=CardiacRisk.colorClasses.rangeSliderThumbWhiteText):CardiacRisk.patientInfo.hdl>=40&&CardiacRisk.patientInfo.hdl<60&&"male"===CardiacRisk.patientInfo.gender||CardiacRisk.patientInfo.hdl>=50&&CardiacRisk.patientInfo.hdl<60&&"female"===CardiacRisk.patientInfo.gender?(a=CardiacRisk.graphData.hdlSliderData.toolTipData.keys[1],b=CardiacRisk.colorClasses.moderateRisk):CardiacRisk.patientInfo.hdl>=60&&(a=CardiacRisk.graphData.hdlSliderData.toolTipData.keys[0],b=CardiacRisk.colorClasses.lowRisk),CardiacRisk.graphData.hdlSliderData.thumbDisplayText=a,CardiacRisk.graphData.hdlSliderData.value=CardiacRisk.patientInfo.hdl,generateRangeSlider(CardiacRisk.graphData.hdlSliderData),changeBarBackgroundColor(CardiacRisk.graphData.hdlSliderData.id,CardiacRisk.colorClasses.grayBarColor),changeThumbBackgroundColor(CardiacRisk.graphData.hdlSliderData.id,b),changeThumbTextColor(CardiacRisk.graphData.hdlSliderData.id,c)}function sbpInputFocusOutHandler(){$(this).val().length<3&&$(this).val(CardiacRisk.patientInfo.systolicBloodPressure)}function isNumberKey(a){var b=a.which?a.which:event.keyCode;if(13===b||b>31&&(48>b||b>57))return!1;$sbpInput=$("#sbpInput");var c=$sbpInput.val();return 2===c.length&&($sbpInput.val(c+String.fromCharCode(b)),onSBPInput()),!0}function adjustRelatedFactorsSize(){var a=$("#containerPatientActions").width();$("#containerPatientDetails").width(a);var b=$("#contentBoxRightBottom").width();$("#contentBoxRightTop").width(b)}function adjustRangeSliderThumbPosition(){updateThumbPosition(CardiacRisk.graphData.totalCholesterolSliderData.id,CardiacRisk.graphData.totalCholesterolSliderData.value,CardiacRisk.graphData.totalCholesterolSliderData.lowerBound,CardiacRisk.graphData.totalCholesterolSliderData.upperBound),updateThumbPosition(CardiacRisk.graphData.ldlSliderData.id,CardiacRisk.graphData.ldlSliderData.value,CardiacRisk.graphData.ldlSliderData.lowerBound,CardiacRisk.graphData.ldlSliderData.upperBound),updateThumbPosition(CardiacRisk.graphData.hdlSliderData.id,CardiacRisk.graphData.hdlSliderData.value,CardiacRisk.graphData.hdlSliderData.lowerBound,CardiacRisk.graphData.hdlSliderData.upperBound)}function buildRangeSliderDataModel(){var a={},b={};if(b.id="totalCholesterolSlider",b.titleLeft="Total Cholesterol",b.titleRight="mg/dL",b.lowerBound=140,b.upperBound=401,b.barBoundsLowDisplay="Desirable",b.barBoundsHighDisplay="High",b.toolTipData={keys:["Desirable","Borderline High","High"],values:["140 - 199","200 - 239","240 - 401"],styleClass:"tooltipsterCardiacRiskTotalCholesterol"},a.totalCholesterolSliderData=b,void 0!==CardiacRisk.patientInfo.ldl){var c={};c.id="ldlBadCholesterolSlider",c.titleLeft='LDL "Bad" Cholesterol',c.titleRight="mg/dL",c.lowerBound=50,c.upperBound=210,c.barBoundsLowDisplay="Optimal",c.barBoundsHighDisplay="High",c.toolTipData={keys:["Optimal","Near/Above Optimal","Borderline High","High","Very High"],values:["50 - 100","101 - 129","130 - 159","160 - 189","190 - 210"],styleClass:"tooltipsterCardiacRiskLDL"},c.barHeight=6,a.ldlSliderData=c}var d={};d.id="hdlGoodCholesterolSlider",d.titleLeft='HDL "Good" Cholesterol',d.titleRight="mg/dL",d.lowerBound=30,d.upperBound=150,d.barBoundsLowDisplay="Protective",d.barBoundsHighDisplay="High","male"===CardiacRisk.patientInfo.gender?d.toolTipData={keys:["High","Higher the Better","Low"],values:["60 - 150","40 - 59","30 - 39"],styleClass:"tooltipsterCardiacRiskHDL"}:"female"===CardiacRisk.patientInfo.gender&&(d.toolTipData={keys:["High","Higher the Better","Low"],values:["60 - 150","50 - 59","30 - 49"],styleClass:"tooltipsterCardiacRiskHDL"}),d.barHeight=6,a.hdlSliderData=d,CardiacRisk.graphData=a}function generateRangeSlider(a){var b=$("#"+a.id);b.append("<header id="+a.id+'Header class="rangeSliderHeaderStyle"><div><span id='+a.id+'TitleLeft class="headerLeftStyle">'+a.titleLeft+"</span><span id="+a.id+'Image class="iconStyle fa fa-info-circle"></span>   </div><span id='+a.id+"TitleRight>"+a.titleRight+'</span></header><div class="rangeSliderContentStyle"><div id='+a.id+'Bar class="rangeSliderBarStyle"></div><div id='+a.id+'Thumb class="rangeSliderThumbStyle">'+a.value+"</div><div id="+a.id+'ThumbDisplayText class="rangeSliderThumbDisplayTextStyle">'+a.thumbDisplayText+"</div></div><footer id="+a.id+'Footer class="rangeSliderFooterStyle"><div class="footerLeftStyle"><span id='+a.id+"FooterLeft>"+a.barBoundsLowDisplay+'</span></div><div class="footerRightStyle"><span id='+a.id+"FooterRight>"+a.barBoundsHighDisplay+"</span></div></footer>"),updateBarHeight(a.id,a.barHeight),updateToolTips(a.id,a.toolTipData),updateThumbPosition(a.id,a.value,a.lowerBound,a.upperBound)}function updateToolTips(a,b){var c='<table class="'+b.styleClass+'">',d="";for(step=0;step<b.keys.length;step++)d=d.concat("<tr>"),d=d.concat('<td class="zeroMargin">'+b.keys[step]+'</td><td> </td><td class="zeroMargin">'+b.values[step]+"</td>"),d=d.concat("</tr>");c=c.concat(d,"</table>"),$("#"+a+"Image").tooltipster({contentAsHTML:!0,delay:100,theme:"tooltipster-CardiacRisk",content:$(c)})}function updateBarHeight(a,b){$("#"+a+"Bar").css("height",""),$("#"+a+"Bar").css("height",b),12>b&&($("#"+a+"Header").css("margin-bottom",2*b),$("#"+a+"Thumb").addClass("barHeightThumbAdjustment"),$("#"+a+"ThumbDisplayText").addClass("barHeightThumbTextAdjustment"),$("#"+a+"Footer").addClass("barFooterAdjustment"))}function changeBarBackgroundColor(a,b){$("#"+a+"Bar").css("background-color",""),$("#"+a+"Bar").addClass(b)}function changeThumbBackgroundColor(a,b){$("#"+a+"Thumb").css("background-color",""),$("#"+a+"Thumb").addClass(b)}function changeThumbTextColor(a,b){b.length&&$("#"+a+"Thumb").removeClass("rangeSliderThumbStyle").addClass(b)}function updateThumbPosition(a,b,c,d){var e=0;if(c>=b)return e=0,changeThumbPositionToPosition(a,e),void changeThumbValueTextToPosition(a,e);var f=$("#"+a+"Bar").width(),g=$("#"+a+"Thumb"),h=g.width()+parseFloat(g.css("padding-left").replace(/[^-\d.]/g,""))+parseFloat(g.css("padding-right").replace(/[^-\d.]/g,""))+parseFloat(g.css("borderLeftWidth").replace(/[^-\d.]/g,""))+parseFloat(g.css("borderRightWidth").replace(/[^-\d.]/g,"")),i=b;b>d&&(i=d);var j=(i-c)/(d-c)*f;e=j-h,0>e&&(e=0),changeThumbPositionToPosition(a,e),changeThumbValueTextToPosition(a,e)}function changeThumbValueTextToPosition(a,b){var c=$("#"+a+"Thumb"),d=$("#"+a+"Bar").width(),e=$("#"+a+"ThumbDisplayText").width(),f=c.width()+parseFloat(c.css("padding-left").replace(/[^-\d.]/g,""))+parseFloat(c.css("padding-right").replace(/[^-\d.]/g,""))+parseFloat(c.css("borderLeftWidth").replace(/[^-\d.]/g,""))+parseFloat(c.css("borderRightWidth").replace(/[^-\d.]/g,"")),g=b+f/2-e/2;0>g&&(g=0),g>d-e&&(g=d-e),$("#"+a+"ThumbDisplayText").css("left",""),$("#"+a+"ThumbDisplayText").css("left",g),g>=0&&g<=$("#"+a+"FooterLeft").width()?$("#"+a+"FooterLeft").css("visibility","hidden"):d>=g+e&&g+e>=d-$("#"+a+"FooterRight").width()&&$("#"+a+"FooterRight").css("visibility","hidden")}function changeThumbPositionToPosition(a,b){$("#"+a+"Thumb").css("left",""),$("#"+a+"Thumb").css("left",b)}!function(a,b){"use strict";var c={},d={};c.colorClasses={lowRisk:"backgroundColorLowRisk",lowModerateRisk:"backgroundColorLowModerateRisk",moderateRisk:"backgroundColorModerateRisk",highRisk:"backgroundColorHighRisk",rangeSliderThumbWhiteText:"rangeSliderThumbStyleWhite",grayBarColor:"colorGray"};var e=function(){function a(a){c.hideDemographicsBanner=a.tokenResponse.need_patient_banner===!1;var e=new Date,g=new Date;if(g.setFullYear(e.getFullYear()-1),a.hasOwnProperty("patient")){var h=a.patient.read(),i=a.patient.api.fetchAll({type:"Observation",query:{code:{$or:["http://loinc.org|2089-1","http://loinc.org|13457-7","http://loinc.org|14647-2","http://loinc.org|2093-3","http://loinc.org|2085-9","http://loinc.org|8480-6"]}}});$.when(h,i).done(function(e,g){d.firstName=e.name[0].given.join(" "),d.lastName=e.name[0].family.join(" "),d.gender=e.gender,d.dateOfBirth=new Date(e.birthDate),d.age=c.computeAgeFromBirthDate(d.dateOfBirth),c.patientInfo=d;var h={};h.smoker=b,h.race="white",h.hypertension=!0,h.diabetic=!0,c.patientInfo.relatedFactors=h;var i=a.byCodes(g,"code");c.processLabsData(i),c.hasObservationWithUnsupportedUnits&&c.isRequiredLabsNotAvailable()&&processError("One or more results has an unsupported unit of measure. Cardiac Risk cannot  be calculated."),f.resolve()}).fail(function(){processError("There was an error loading the application.")})}else processError("There was an error loading the application.")}function e(){processError("There was an error loading the application."),f.reject()}c.shouldProcessError=!0;var f=$.Deferred();return FHIR.oauth2.ready(a,e),f.promise()};c.fetchDataAndPopulateCardiacRiskObject=e;var f=function(a){c.hasObservationWithUnsupportedUnits=!1,c.patientInfo.totalCholesterol=c.getCholesterolValue(a("14647-2","2093-3")),c.patientInfo.hdl=c.getCholesterolValue(a("2085-9")),c.patientInfo.ldl=c.getCholesterolValue(a("2089-1")),c.patientInfo.ldlCalculated=c.getCholesterolValue(a("13457-7")),c.patientInfo.systolicBloodPressure=c.getSystolicBloodPressureValue(a("8480-6")),c.patientInfo.ldl===b&&(c.patientInfo.ldl=c.patientInfo.ldlCalculated)};c.processLabsData=f;var g=function(a){return a.sort(function(a,b){return Date.parse(b.appliesDateTime)-Date.parse(a.appliesDateTime)}),a};c.sortObservationsByAppliesTimeStamp=g;var h=function(a){return c.getFirstValidDataPointValueFromObservations(a,function(a){return"mg/dL"===a.valueQuantity.unit?parseFloat(a.valueQuantity.value):"mmol/L"===a.valueQuantity.unit?parseFloat(a.valueQuantity.value)/.026:b})};c.getCholesterolValue=h;var i=function(a){return c.getFirstValidDataPointValueFromObservations(a,function(a){return"mm[Hg]"===a.valueQuantity.unit||"mmHg"===a.valueQuantity.unit?parseFloat(a.valueQuantity.value):b})};c.getSystolicBloodPressureValue=i;var j=function(a,d){for(var e=c.sortObservationsByAppliesTimeStamp(a),f=0;f<e.length;f++)if(("final"===e[f].status.toLowerCase()||"amended"===e[f].status.toLowerCase())&&e[f].hasOwnProperty("valueQuantity")&&e[f].valueQuantity.value&&e[f].valueQuantity.unit){var g=d(e[f]);if(g!==b)return g;c.hasObservationWithUnsupportedUnits=!0}return b};c.getFirstValidDataPointValueFromObservations=j;var k=function(a){function b(a){return 1==new Date(a,1,29).getMonth()}var c=new Date,d=c.getFullYear()-a.getFullYear();a.setFullYear(a.getFullYear()+d),a>c&&(d--,a.setFullYear(a.getFullYear()-1));var e=(c.getTime()-a.getTime())/864e5;return Math.floor(d+e/(b(c.getFullYear())?366:365))};c.computeAgeFromBirthDate=k;var l=function(a){var b=0;return Math.round(10>b?b.toPrecision(1):b.toPrecision(2))};c.computeRRS=l;var m=function(a){var b=Math.log(a.age),c=Math.log(a.totalCholesterol),d=Math.log(a.hdl),e=a.relatedFactors.hypertension?Math.log(parseFloat(a.systolicBloodPressure)):0,f=a.relatedFactors.hypertension?0:Math.log(parseFloat(a.systolicBloodPressure)),g=b*c,h=b*d,i=b*e,j=b*f,k=a.relatedFactors.smoker?b:0,l="aa"===a.relatedFactors.race,m="male"===a.gender,n=0,o=0,p=0,q=function(){return l&&!m?(n=.95334,o=86.6081,p=17.1141*b+.9396*c+-18.9196*d+4.4748*h+29.2907*e+-6.4321*i+27.8197*f+-6.0873*j+.6908*Number(a.relatedFactors.smoker)+.8738*Number(a.relatedFactors.diabetic)):l||m?l&&m?(n=.89536,o=19.5425,p=2.469*b+.302*c+-.307*d+1.916*e+1.809*f+.549*Number(a.relatedFactors.smoker)+.645*Number(a.relatedFactors.diabetic)):(n=.91436,o=61.1816,p=12.344*b+11.853*c+-2.664*g+-7.99*d+1.769*h+1.797*e+1.764*f+7.837*Number(a.relatedFactors.smoker)+-1.795*k+.658*Number(a.relatedFactors.diabetic)):(n=.96652,o=-29.1817,p=-29.799*b+4.884*Math.pow(b,2)+13.54*c+-3.114*g+-13.578*d+3.149*h+2.019*e+1.957*f+7.574*Number(a.relatedFactors.smoker)+-1.665*k+.661*Number(a.relatedFactors.diabetic)),1-Math.pow(n,Math.exp(p-o))};return q()};c.computeTenYearASCVD=m;var n=function(){var a=$.extend(!0,{},c.patientInfo);return a.totalCholesterol=170,a.hdl=50,a.systolicBloodPressure=110,a.relatedFactors.hypertension=!1,a.relatedFactors.diabetic=!1,a.relatedFactors.smoker=!1,c.computeTenYearASCVD(a)};c.computeOptimalASCVD=n;var o=function(a,b){if(a.age<20||a.age>59)return null;var c=0,d={male:{major2:69,major1:50,elevated:46,notOptimal:36,allOptimal:5},female:{major2:50,major1:39,elevated:39,notOptimal:27,allOptimal:8}},e=(a.totalCholesterol>=240?1:0)+((a.systolicBloodPressure>=160?1:0)+(a.hypertension?1:0))+(a.relatedFactors.smoker?1:0)+(a.relatedFactors.diabetes?1:0),f=((a.totalCholesterol>=200&&a.totalCholesterol<240?1:0)+(a.systolicBloodPressure>=140&&a.systolicBloodPressure<160&&a.relatedFactors.hypertension===!1?1:0)>=1?1:0)*(0===e?1:0),g=((a.totalCholesterol<180?1:0)+(a.systolicBloodPressure<120?1:0)*(a.relatedFactors.hypertension?0:1)==2?1:0)*(0===e?1:0),h=((a.totalCholesterol>=180&&a.totalCholesterol<200?1:0)+(a.systolicBloodPressure>=120&&a.systolicBloodPressure<140&&a.relatedFactors.hypertension===!1?1:0))*(0===f?1:0)*(0===e?1:0)>=1?1:0;return e>1&&(c=d[a.gender.major2]),1===e&&(c=d[a.gender.major1]),1===f&&(c=d[a.gender.elevated]),1===h&&(c=d[a.gender.notOptimal]),1===g&&(c=d[a.gender.allOptimal]),b?"male"===a.gender?5:8:c};c.computeLifetimeRisk=o;var p=function(){var a={},d=$.extend(!0,{},c.patientInfo);if(d.systolicBloodPressure>=129)d.systolicBloodPressure=d.systolicBloodPressure-10;else if(d.systolicBloodPressure>=120&&d.systolicBloodPressure<129)d.systolicBloodPressure=119;else if(d.systolicBloodPressure>=105&&d.systolicBloodPressure<120)return b;var e=c.computeRRS(d);return a.value=e+"%",a.valueText=d.systolicBloodPressure+" mm/Hg",a};c.computeWhatIfSBP=p;var q=function(){var a=$.extend(!0,{},c.patientInfo);return a.relatedFactors.smoker=!1,c.computeRRS(a)};c.computeWhatIfNotSmoker=q;var r=function(){var a=$.extend(!0,{},c.patientInfo);return a.totalCholesterol=160,a.hdl=60,a.ldl=100,a.systolicBloodPressure=119,a.relatedFactors.smoker=!1,c.computeRRS(a)};c.computeWhatIfOptimal=r;var s=function(){var a={};return c.patientInfo.totalCholesterol<=160&&c.patientInfo.ldl<100&&c.patientInfo.hdl>=60?(a.dietHeader="Continue to eat a healthy diet and exercise",a.diet="A healthy diet and regular exercise can keep cholesterol levels optimal.",a.doctorHeader="Talk to your doctor",a.doctor="Discuss the need to follow up with your primary care provider to monitor your health"):(c.patientInfo.totalCholesterol>=160||c.patientInfo.ldl>=130||c.patientInfo.hdl<=60)&&(a.dietHeader="Improve your diet and exercise more",a.diet="A better diet and regular exercise can drastically improve your cholesterol levels.",a.doctorHeader="Talk to your doctor",a.doctor="Discuss statins or other medications with your primary care provider that can help lower cholesterol."),a};c.computePatientActions=s;var t=function(){var a="";return isNaN(c.patientInfo.totalCholesterol)||0===c.patientInfo.totalCholesterol.length||c.patientInfo.totalCholesterol===b?a="Cardiac Risk cannot be calculated without a valid value for Total Cholesterol.":(isNaN(c.patientInfo.hdl)||0===c.patientInfo.hdl.length||c.patientInfo.hdl===b)&&(a="Cardiac Risk cannot be calculated without a valid value for HDL."),a};d.validateLabsForMissingValueErrors=t;var u=function(){var a="";return c.patientInfo.totalCholesterol<140?a="Total Cholesterol levels are too low to return a cardiac risk score.":c.patientInfo.totalCholesterol>401?a="Total Cholesterol levels are too high to return a cardiac risk score.":c.patientInfo.hdl<30?a="HDL levels are too low to return a cardiac risk score.":c.patientInfo.hdl>150&&(a="HDL levels are too high to return a cardiac risk score."),a};d.validateLabsForOutOfBoundsValueErrors=u;var v=function(a){var b={};return b.value=a+"%",c.patientInfo.relatedFactors.smoker!==!0||c.optimalLabs()?c.patientInfo.relatedFactors.smoker!==!1||c.optimalLabs()?c.patientInfo.relatedFactors.smoker===!1&&c.optimalLabs()&&a>5?(b.value="",b.valueText="Your risk is the lowest it can be based on the supplied information"):c.optimalLabs()&&(b.value="",b.valueText="All levels are currently optimal"):b.valueText=" if all levels were optimal":b.valueText=" if you quit smoking and all levels were optimal",b};c.buildWhatIfOptimalValues=v;var w=function(a){var b={};return b.value=a+"%",b};c.buildWhatIfNotSmoker=w;var x=function(){return c.isValidSysBP(c.patientInfo.systolicBloodPressure)&&c.patientInfo.relatedFactors.smoker!==b?!0:!1};c.canCalculateCardiacRiskScore=x;var y=function(){return c.isValidSysBP(c.patientInfo.systolicBloodPressure)&&c.patientInfo.relatedFactors.hypertension!==b&&c.patientInfo.relatedFactors.race!==b&&c.patientInfo.relatedFactors.diabetic!==b&&c.patientInfo.relatedFactors.smoker!==b?!0:!1};c.canCalculateASCVDScore=y;var z=function(){return c.patientInfo.totalCholesterol===b||c.patientInfo.hdl===b||c.patientInfo.ldl===b||c.patientInfo.systolicBloodPressure===b?!0:!1};c.isLabsNotAvailable=z;var A=function(){return c.patientInfo.totalCholesterol===b||c.patientInfo.hdl===b?!0:!1};c.isRequiredLabsNotAvailable=A;var B=function(a){return!isNaN(a)&&a!==b&&a>=105&&200>=a?!0:!1};c.isValidSysBP=B;var C=function(){var a=!1;return c.patientInfo.totalCholesterol>=140&&c.patientInfo.totalCholesterol<=199&&c.patientInfo.hdl>=60&&c.patientInfo.hdl<=150&&c.patientInfo.ldl>=50&&c.patientInfo.ldl<=100&&(a=!0),a};c.optimalLabs=C;var D=function(){var a="";return c.patientInfo.age<45||c.patientInfo.age>80?a="Cardiac risk can only be calculated for patients aged 45-80 years old.":"male"!==c.patientInfo.gender.toLowerCase()&&"female"!==c.patientInfo.gender.toLowerCase()&&(a="Cardiac Risk Score cannot be calculated for indeterminate gender."),0===a.length&&(a=c.patientInfo.validateLabsForMissingValueErrors()),0===a.length&&(a=c.patientInfo.validateLabsForOutOfBoundsValueErrors()),a};c.validateModelForErrors=D,a.CardiacRisk=c,a.CardiacRisk.patientInfo=d,c._window=a}(this),CardiacRisk.fetchDataAndPopulateCardiacRiskObject().then(function(){CardiacRisk.hideDemographicsBanner?$("#patientDemographics").addClass("contentHidden"):($("#patientDemographics").removeClass("contentHidden"),updatePatientDemographicsBanner()),validData()&&($("#pageLoading").removeClass().addClass("contentHidden"),$("#pageContent").removeClass().addClass("contentLayout"),updatePatientActions(),checkForIncompleteState(),createRangeSliderGraphs(),addEventListeners(),adjustRelatedFactorsSize())});